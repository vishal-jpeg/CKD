trigger:
  none

name: Deploy pwsh files

variables:
  - group: Secrets-VG  # This includes ServiceAccountPassword securely
  azureServiceConnection: 'ctb-ac-sc-mb-graph'
  powershellFile: './CTB/TemplateFiles/PowershellSpts/PIMAssignment.ps1'

pool:
  name: Merchantss

stages:
  - stage: PowershellCodeExecution
    jobs:
      - job: PowershellCodeExecution
        displayName: Powershell Scripts
        steps:
          - task: AzurePowerShell@5
            inputs:
              ScriptType: 'FilePath'
              azureSubscription: $(azureServiceConnection)
              ScriptPath: $(powershellFile)
              ScriptArguments: >
                -AzureDevOpsOrgUrl "https://dev.azure.com/YOUR_ORG"
                -ServiceAccountUsername "your-user@domain.com"
                -ServiceAccountPassword "$(ServiceAccountPassword)"
                -KeyVaultName "your-kv-name"
                -SecretName "your-secret-name"
              azurePowerShellVersion: 'latestVersion'
              pwsh: false  # Set to true if your script uses PowerShell Core (pwsh)
