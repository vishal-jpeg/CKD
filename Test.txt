Great! Since youâ€™ve already updated the Azure DevOps YAML file âœ…,
here is the full list of changes you need to make outside YAML (inside your Bicep code):


---

âœ… Required Changes in Bicep (Non-YAML Changes):

âœ… 1. Add a new runtime parameter (RCGName) in your main.bicep

This will receive the RCG name that the user selects from the Azure DevOps portal.

@allowed([
  'All'
  'rcgsbdefault01'
  'rcgsbdefault02'
])
param RCGName string = 'All'


---

âœ… 2. Filter the RCG Deployment Loop Based on Selected RCG

Wherever you currently have your RCG deployment loop (like below):

module firewallPolicyRuleCollectionGroups 'Module/RCG/rcg.bicep' = [
  for rulecollectionGroup in firewallPoliciesDeploy: {
    name: 'ruleCollectionGroup-${uniqueString(rulecollectionGroup.existingFirewallPolicyName, rulecollectionGroup.ruleCollectionGroups[0].name)}'
    dependsOn: [
      firewallPolicyParent
    ]
    params: {
      ruleCollectionGroup: {
        existingFirewallPolicyName: rulecollectionGroup.existingFirewallPolicyName
        ruleCollectionGroups: rulecollectionGroup.ruleCollectionGroups
        rgName: rulecollectionGroup.rgName
        subscriptionId: rulecollectionGroup.subscriptionId
      }
    }
  }
]

ðŸ‘‰ Replace with this filtered deployment loop:

var selectedRCGs = RCGName == 'All' ? firewallPoliciesDeploy : [
  for rcg in firewallPoliciesDeploy: if (RCGName == rcg.ruleCollectionGroups[0].name) {
    rcg
  }
]

module firewallPolicyRuleCollectionGroups 'Module/RCG/rcg.bicep' = [
  for rulecollectionGroup in selectedRCGs: {
    name: 'ruleCollectionGroup-${uniqueString(rulecollectionGroup.existingFirewallPolicyName, rulecollectionGroup.ruleCollectionGroups[0].name)}'
    dependsOn: [
      firewallPolicyParent
    ]
    params: {
      ruleCollectionGroup: {
        existingFirewallPolicyName: rulecollectionGroup.existingFirewallPolicyName
        ruleCollectionGroups: rulecollectionGroup.ruleCollectionGroups
        rgName: rulecollectionGroup.rgName
        subscriptionId: rulecollectionGroup.subscriptionId
      }
    }
  }
]


---

âœ… 3. (Optional) - If you want to filter firewall deployment too

If your main.bicep also deploys firewall policies and you want to filter those too, youâ€™ll need similar logic for firewall policy modules.
Let me know if you want that.


---

âœ… 4. No Changes Required in:

You donâ€™t need to change your rcg.bicep, rcg-sb-default-01.bicep, rcg-importbicep.bicep etc.
They can stay as-is.


---

âœ… âœ… Summary of Required Bicep Changes:

File	Action

main.bicep	âœ… Add RCGName parameter
main.bicep	âœ… Filter the RCG deployment loop based on selected RCG
main.bicep	âœ… Optional: Add similar filtering for firewall policy deployment (if needed)



---

If you want, I can generate the full final clean main.bicep file with all these changes included.

ðŸ‘‰ Want me to?

