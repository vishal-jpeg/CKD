// Firewall Policy (only deploys when requested)
module firewallPolicy 'br/modules:network/firewall-policy:0.2' = 
  if (Resource == 'Firewall Policy') {
    scope: resourceGroup(firewallDeploy.subscriptionId, firewallDeploy.rgName)
    // ... params ...
  }

// RCGs (only deploy when explicitly requested)
module rcgDeployment 'br/modules:network/firewall-policy/rule-collection-group:0.1' = 
  [for rcgConfig in selectedRCGConfigs: if (Resource == 'Rule Collection Group') {
    scope: resourceGroup(rcgConfig.existingSubscriptionId, rcgConfig.existingResourceGroupName)
    name: 'rcg-${uniqueString(rcgConfig.existingFirewallPolicyName, rcgConfig.ruleCollectionGroups[0].name)}'
    params: {
      existingFirewallPolicyName: rcgConfig.existingFirewallPolicyName
      existingResourceGroupName: rcgConfig.existingResourceGroupName
      existingSubscriptionId: rcgConfig.existingSubscriptionId
      name: rcgConfig.ruleCollectionGroups[0].name
      priority: rcgConfig.ruleCollectionGroups[0].priority
      ruleCollections: rcgConfig.ruleCollectionGroups[0].ruleCollections
    }
  }]
