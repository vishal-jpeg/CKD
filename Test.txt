parameters:
- name: selectedRCGs
  displayName: 'Select RCGs to Deploy'
  type: object
  default:
    - rcg_sb_default_01
    - rcg_sb_default_02
  values:
    - rcg_sb_default_01
    - rcg_sb_default_02

variables:
  selectedRCGsJson: ${{ convertToJson(parameters.selectedRCGs) }}

stages:
- stage: DeployRCGs
  jobs:
  - job: Deploy
    steps:
    - task: AzureCLI@2
      displayName: 'Deploy Selected RCGs'
      inputs:
        azureSubscription: 'your-service-connection'
        scriptType: 'pscore'
        scriptLocation: 'inlineScript'
        inlineScript: |
          $selected = '$(selectedRCGsJson)' | ConvertFrom-Json
          $rcgParams = $selected | ConvertTo-Json -Compress
          
          az deployment sub create `
            --location eastus `
            --template-file main.bicep `
            --parameters selectedRCGs="$rcgParams"
